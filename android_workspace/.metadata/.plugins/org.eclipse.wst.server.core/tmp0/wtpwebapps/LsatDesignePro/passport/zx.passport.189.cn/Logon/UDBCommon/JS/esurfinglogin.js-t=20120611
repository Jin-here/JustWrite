/*
Script: esurfinglogin.js
	esurfing login info javascript.

Copyright:
	copyright (c) 2012 cndatacom
*/

var EsurfingLoginInfo = function(){
	var o, s, xml;
	this.state = -9;
	if (window.ActiveXObject) {
		try {
			o = new ActiveXObject("LoginAccount.GetLoginAccount");
			if (o == null) {
	    	return;
	    }
		}catch(e){
			return;
		}
		this.state = -8;
		try {
			s = o.GetInfo();
		}catch(e){
			return ;
		}
	}
	else if(navigator.mimeTypes["application/cwc-websso"]){
		o = document.createElement("embed");
		o.type="application/cwc-websso";
		o.style.width="0px";
		o.style.height="0px";
		document.body.appendChild(o);
		try {
			s = o.Info;
		}catch(e){
			document.body.removeChild(o);
			return ;
		}
		document.body.removeChild(o);
	}
	else {
		return;
	}
  if (s == null || s.length == 0) {
  	this.state = -1;
  	return;
  }
	this.state = -2;
	if ((xml = this.loadXML(s)) == null) {
		return;
	}
	this.account = this.getXmlValue(xml, 'Account');
	this.token = this.getXmlValue(xml, 'Token');
	this.state = (this.account != "" && this.token != "") ? 0 : -1;
};

EsurfingLoginInfo.prototype = {
	account : '',
	token : '',
	state : -9,
	loadXML : function(xmlstr){
		var xmlDoc=null;
	  if(!window.DOMParser && window.ActiveXObject){
			var xmlDomVersions = ['MSXML.2.DOMDocument.6.0','MSXML.2.DOMDocument.3.0','Microsoft.XMLDOM'];
			for(var i=0;i<xmlDomVersions.length;i++){
				try{
					xmlDoc = new ActiveXObject(xmlDomVersions[i]);
					xmlDoc.async = false;
					xmlDoc.loadXML(xmlstr);
					break;
				}catch(e){
				}
			}
		}
	  else if(window.DOMParser && document.implementation && document.implementation.createDocument){
			try{
				domParser = new  DOMParser();
				xmlDoc = domParser.parseFromString(xmlstr, 'text/xml');
			}catch(e){
			}
		}
		else{
			return null;
		}
		return xmlDoc;
	},
	getXmlValue : function(x, t){
		var a = x.getElementsByTagName(t);
		if (a.length < 1) {
			return "";
		}
		return a[0].getAttribute("Val");
	}

};