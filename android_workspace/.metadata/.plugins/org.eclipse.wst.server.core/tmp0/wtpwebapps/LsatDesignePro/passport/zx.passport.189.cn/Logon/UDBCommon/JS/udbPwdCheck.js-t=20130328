// JScript 文件


//var ErrMsgForLoginCheck= '密码简单或首次登陆,请<a href="http://passport.189.cn/Get.aspx" //target="_blank">重置密码</a>';
var ErrMsgForComPwdUpdate= '请不要设置规律过于简单的密码，如：111111或123456';

var ErrMsgForReadCheck='您还没勾选已阅读';

var ErrMsgForYzmCheck='请您输入验证码';

//检验密码是否为强密码
var ValidatePwd =function(){

try{
          
        var UserID = document.getElementById("txtUserID").value;
        var Pwd = document.getElementById("txtPwd").value;
        
        var patten = new RegExp("^[0-9]*$");  
        var IsPwdNumeric = patten.test(Pwd);

        if(!BasicClientValidate(UserID,Pwd)){
            return false;
        }
        
	    if (Pwd.length < 6)
	    {
	        SetClientErrMsg(ErrMsgForLoginCheck);
            return false;
        }

        if (IsPwdNumeric)
        {     
            //判断字符串中字符是否都相同    
            if (IsAllCharsEquals(Pwd)){
	            SetClientErrMsg(ErrMsgForLoginCheck);
                return false;
            }
            //密码取值递减
            if (IsDecreasing(Pwd)){
	            SetClientErrMsg(ErrMsgForLoginCheck);
                return false;
            }    
            //密码取值递增
            if (IsIncreasing(Pwd)){
	            SetClientErrMsg( ErrMsgForLoginCheck);
                return false;
            }

         }

    }
    catch(err)
    {
    }
    
    return true;
}

//是否已阅读检查
var ReadAgreementCheck = function(){

    //检查勾选已阅读
    var checkValue = document.getElementById("Readed");
    if (checkValue.checked == false)
    {
        SetClientErrMsg(ErrMsgForReadCheck);
        return false;
    }
    
    return true;

}
var ReadAgreementCheck2 = function(){

    //检查勾选已阅读
    var checkValue = document.getElementById("Readed2");
    if (checkValue.checked == false)
    {
        SetClientErrMsg(ErrMsgForReadCheck);
        return false;
    }
    
    return true;

}

var setinter ;
var MaxTime = 61;

var intervalId ;

//短信密码认证页面
//认证前Check
var ValidatePwd_SR =function(){

    var UserID = document.getElementById("txtUserID").value;
    var Pwd = document.getElementById("txtPwd").value;
    
    //密码是手机号后6位是否为弱密码
    if( UserID.length == 11 && UserID.substring(0,1) == '1' && !isNaN(UserID))
    {
	    //验证码检查
        var captchaText= document.getElementById("ValidateCode").value;
        if(captchaText=='')
        {
            SetClientErrMsg(ErrMsgForYzmCheck);
            return false;
        }
    }
    else
    {
        SetClientErrMsg("请您输入手机号。");
        return false;
    }
    if (Pwd.length ==0){
        SetClientErrMsg("请您输入短息密码。");
        return false;
    }
    return true;
}


////下发密码
////获取短信密码检查
//var GetPhonePasswordCheck =function(){

//    var UserID = document.getElementById("txtUserID").value;
//    
//    if(document.getElementById("GetPhonePasswordCheckFlag").value == '1')
//    {
//        SetClientErrMsg("请勿重复提交。");
//        return false;
//    }

//    //账号必须为手机号
//    if( UserID.length == 11 && UserID.substring(0,1) == '1' && !isNaN(UserID))
//    {
//    	return true;
//    }
//    else
//    {
//        SetClientErrMsg("请您输入手机号。");
//        return false;
//    }
//    
//}



//获取短信密码检查Test
function GetPhonePasswordCheck(){

    var UserID = document.getElementById("txtUserID").value;
    
    //账号必须为手机号
    if( UserID.length == 11 && UserID.substring(0,1) == '1' && !isNaN(UserID))
    {
	    //验证码检查
        var captchaText= document.getElementById("ValidateCode").value;
        if(captchaText=='')
        {
            SetClientErrMsg(ErrMsgForYzmCheck);
            return ;
        }
    
        document.getElementById("GetPhonePassword").disabled = true;
        document.getElementById("shortPWDIV").className = 'smsPwdBg2';
        document.getElementById("GetPhonePassword").className = 'smsPwd2';
        
        var xmlhttp;
        if (window.XMLHttpRequest)
        {// code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp=new XMLHttpRequest();
        }
        else
        {// code for IE6, IE5
            xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
        }
        
        xmlhttp.onreadystatechange=function()
          {
              if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    var rsparr = new Array();
                    rsparr  = xmlhttp.responseText.split(",");
                    
                    var result = rsparr[0];
                    var resMsg = rsparr[1];
                    if(result != '0')
                    {                    
                        document.getElementById("GetPhonePassword").value = '下发密码';
                        document.getElementById("GetPhonePassword").disabled = false;
                        document.getElementById("shortPWDIV").className = 'smsPwdBg';
                        document.getElementById("GetPhonePassword").className = 'smsPwd';
                        if(result == 95 || result == 96)
                        {
                            document.getElementById("ValidateCode").value='';
                            RefreshCode();
                        }
                        SetClientErrMsg(resMsg);
                        return ;
                    }
                    document.getElementById("GetPhonePassword").disabled = true;
                    MaxTime = 61;
                    intervalId = window.setInterval('ShowSendBtnLater()', 1000);
                 }
                 else if (xmlhttp.readyState==4)
                 {
                    
                    document.getElementById("GetPhonePassword").value = '下发密码';
                    document.getElementById("GetPhonePassword").disabled = false;
                    document.getElementById("shortPWDIV").className = 'smsPwdBg';
                    document.getElementById("GetPhonePassword").className = 'smsPwd';
                    
                    SetClientErrMsg('服务器忙，请稍后再试');
                    return;
                 }
          }
        xmlhttp.open("post","http://zx.passport.189.cn/Logon/UDBCommon/JS/PassPortLoginSenSMS.aspx",true);
        xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");

        var postVal = 'NUM=' + document.getElementById("txtUserID").value +'&ValidateCode=' + captchaText +'&PageguidValue=' +document.getElementById("pageguid").value + '&SrcSsDeviceNo=' + document.getElementById("lblSrcSsDeviceNo").value;
        
        xmlhttp.send(postVal);
        
        
        var lbl =  document.getElementById("lbl_Msg");
	    var errDemo = document.getElementById("errDemo");
	    if(errDemo != null)
	    {
	    errDemo.style.visibility= 'hidden';
	    lbl.innerHTML = '' ; 
	    }
    	return ;
    }
    else
    {
        SetClientErrMsg("请您输入手机号。");
        document.getElementById("GetPhonePassword").disabled = false;
        return ;
    }
    
}



//下发短信验证码后一分钟之后才可以继续下发

var ShowSendBtnLater =function(){


        if (this.MaxTime > 1){
            this.MaxTime = this.MaxTime - 1;
            
            var showPadChar = '';
            if (this.MaxTime < 10){
                showPadChar = '0';
            }
            document.getElementById("GetPhonePassword").disabled = true;
            document.getElementById("GetPhonePassword").value = showPadChar+this.MaxTime+'秒'+'重试';
            document.getElementById("shortPWDIV").className = 'smsPwdBg2';
            document.getElementById("GetPhonePassword").className = 'smsPwd2';
            
        }
        else{
            window.clearInterval(intervalId);
            document.getElementById("GetPhonePassword").value = '下发密码';
            document.getElementById("GetPhonePassword").disabled = false;
            document.getElementById("shortPWDIV").className = 'smsPwdBg';
            document.getElementById("GetPhonePassword").className = 'smsPwd';
            
        }
}

//检验密码是否为强密码--增加勾选已阅读检查
var ValidatePwd_AddReadCheck =function(){

try{
          
        var UserID = document.getElementById("txtUserID").value;
        var Pwd = document.getElementById("txtPwd").value;
        
        var patten = new RegExp("^[0-9]*$");  
        var IsPwdNumeric = patten.test(Pwd);
        
        if(!BasicClientValidate(UserID,Pwd)){
            return false;
        }
        
	    if (Pwd.length < 6)
	    {
	        SetClientErrMsg(ErrMsgForLoginCheck);
            return false;
        }

        //密码是手机号后6位是否为弱密码
        if(UserID.substring(0,1) == '1' && UserID.length == 11)
        {
        	if(Pwd == UserID.substring(5, 11))
        	{
        	    SetClientErrMsg(ErrMsgForLoginCheck);
        	    return false;
        	}
        }
       
        //密码是账号为弱密码(新增)
        if(Pwd == UserID)
    	{
    	    SetClientErrMsg(ErrMsgForLoginCheck);
    	    return false;
    	}
        if (IsPwdNumeric)
        {     
            //判断字符串中字符是否都相同    
            if (IsAllCharsEquals(Pwd)){
	            SetClientErrMsg(ErrMsgForLoginCheck);
                return false;
            }
            //密码取值递减
            if (IsDecreasing(Pwd)){
	            SetClientErrMsg(ErrMsgForLoginCheck);
                return false;
            }    
            //密码取值递增
            if (IsIncreasing(Pwd)){
	            SetClientErrMsg( ErrMsgForLoginCheck);
                return false;
            }

         }
         
        
        //验证码检查
        //var isShow=  document.getElementById("Unlogin").className;
        var isShow=  document.getElementById("captchaform").style.display;
        var captchaText= document.getElementById("ValidateCode").value;
        if(isShow=="block"||isShow=='')
        //if(isShow=="unLogin hasYanzm")
        {
            if(captchaText=='输入验证码'||captchaText=='')
            {
                SetClientErrMsg(ErrMsgForYzmCheck);
                return false;
            }
        }
         
        //检查勾选已阅读
        var checkValue = document.getElementById("Readed");
        if (checkValue.checked == false)
        {
            SetClientErrMsg(ErrMsgForReadCheck);
            return false;
        }
        

    }
    catch(err)
    {
    }
    
    return true;
}


//检验密码是否为强密码--增加勾选已阅读检查(新小页面)
var ValidatePwd_AddReadCheckForNS =function(){

try{
          
        var UserID = document.getElementById("txtUserID").value;
        var Pwd = document.getElementById("txtPwd").value;
        
        var patten = new RegExp("^[0-9]*$");  
        var IsPwdNumeric = patten.test(Pwd);
        
        var UserIDReg = new RegExp("^1\d{10}$"); 
        var UserChk = patten.test(UserID);
        
        if(!BasicClientValidate(UserID,Pwd)){
            return false;
        }
        
	    if (Pwd.length < 6)
	    {
	        SetClientErrMsg(ErrMsgForLoginCheck);
            return false;
        }

        //密码是手机号后6位是否为弱密码
        //if( UserID.length != 11 || UserID.substring(0,1) != '1' && !isNaN(UserID))
        if(!UserChk)
        {
        	SetClientErrMsg("请输入手机号");
    	    return false;
        }
        if(Pwd == UserID.substring(5, 11))
    	{
    	    SetClientErrMsg(ErrMsgForLoginCheck);
    	    return false;
    	}
       
        //密码是账号为弱密码(新增)
        if(Pwd == UserID)
    	{
    	    SetClientErrMsg(ErrMsgForLoginCheck);
    	    return false;
    	}
        if (IsPwdNumeric)
        {     
            //判断字符串中字符是否都相同    
            if (IsAllCharsEquals(Pwd)){
	            SetClientErrMsg(ErrMsgForLoginCheck);
                return false;
            }
            //密码取值递减
            if (IsDecreasing(Pwd)){
	            SetClientErrMsg(ErrMsgForLoginCheck);
                return false;
            }    
            //密码取值递增
            if (IsIncreasing(Pwd)){
	            SetClientErrMsg( ErrMsgForLoginCheck);
                return false;
            }

         }
         
        
        //验证码检查
        //var isShow=  document.getElementById("Unlogin").className;
        var isShow=  document.getElementById("captchaform").style.display;
        var captchaText= document.getElementById("ValidateCode").value;
        if(isShow=="block"||isShow=='')
        //if(isShow=="unLogin hasYanzm")
        {
            if(captchaText=='输入验证码'||captchaText=='')
            {
                SetClientErrMsg(ErrMsgForYzmCheck);
                return false;
            }
        }
         
        //检查勾选已阅读
        var checkValue = document.getElementById("Readed");
        if (checkValue.checked == false)
        {
            SetClientErrMsg(ErrMsgForReadCheck);
            return false;
        }
        

    }
    catch(err)
    {
    }
    
    return true;
}

///
///检验密码是否为强密码
///
var ValidatePwdForUpdate =function(){

try{ 
        var UserID = document.getElementById("UserID").value;
        
        //用户正在使用的密码
        var CurPasswod = document.getElementById("txt_oldPwd").value;
        
        //用户欲设置的新密码
        var Pwd = document.getElementById("txt_curPwd").value;
        
        var patten = new RegExp("^[0-9]*$");  
        var IsPwdNumeric = patten.test(Pwd);
        var FirstChar =  UserID.substring(0,1)
//        var IsUserIDNumeric = patten.test(FirstChar);
//        var IsNumeric = patten.test(Pwd);
           
        //未输入使用的密码   
        if(CurPasswod.length == 0)
        {
            SetClientErrMsgForUpdate( '请输入您的现用密码！');
            return false;
        }
  
	    if (Pwd.length < 6)
	    {
	        SetClientErrMsgForUpdate(ErrMsgForComPwdUpdate);
            return false;
        }

        if (IsPwdNumeric){  

            //判断字符串中字符是否都相同    
            if (IsAllCharsEquals(Pwd)){  
	            SetClientErrMsgForUpdate(ErrMsgForComPwdUpdate);
                return false;
            }
            
            //密码取值递减
            if (IsDecreasing(Pwd)){
	            SetClientErrMsgForUpdate( ErrMsgForComPwdUpdate);
                return false;
            }    

            //密码取值递增
            if (IsIncreasing(Pwd)){

	            SetClientErrMsgForUpdate(ErrMsgForComPwdUpdate);
                return false;
            }

         }
         
         //密码和账号相同为弱密码(新增)
         if (UserID.replace('http://zx.passport.189.cn/Logon/UDBCommon/JS/@189.cn','') == Pwd){
        	SetClientErrMsgForUpdate(ErrMsgForComPwdUpdate);
            return false;
         }
         
//         //用户名登录
//         if (IsUserIDNumeric){
//            if (UserID == Pwd){
//            	SetClientErrMsg( ErrMsgForLoginCheck);
//                return false;
//            }
//         }
         //else{别名登录:不做其他校验}
         
//        //密码中任意连续8位（如与帐号连续8位相同）
//        if(IsUseridContainsPwdParts(UserID,Pwd)){
//	            SetClientErrMsgForUpdate(ErrMsgForComPwdUpdate);
//                return false;
//        }

    }
    catch(err)
    {
        alert(err);
    }
    
    return true;
}

//判断串中所有字符是否都相同
var IsAllCharsEquals = function (SrcStr){
                                       
        var fChar = SrcStr.charAt(0);  
                        
        for (var i = 0; i < SrcStr.length; i++)
        {                                                           
            if (i > 0)
            {
            
                var sss= SrcStr.charAt(i);
                if (fChar != sss)
                { 
                    return false;  
                }
            }
        }
        return true;
}

//递增判断
var IsIncreasing = function (SrcStr){
        var NMin = Number( SrcStr.charAt(0))
        for (var i = 0; i < SrcStr.length; i++)
        {
            if (i > 0)
            {
                NMin++;
                if (Number(SrcStr.charAt(i)) != NMin)
                {  return false; }
            }
        }
        return true;
}

//递减判断
var IsDecreasing = function (SrcStr){
        var NMax = Number(SrcStr.charAt(0));
        for (var i = 0; i < SrcStr.length; i++)
        {
            if (i > 0)
            {
                NMax--;
                if (Number(SrcStr.charAt(i)) != NMax)
                {  return false; }
            }
        }
        return true;
}

//判断密码的连续6位包含在账号中
var IsUseridContainsPwdParts = function (UserID,Pwd){
    var arrLength = Pwd.length - 5;
    if (arrLength >=1)
    {
        var StrArr =new Array(arrLength);
        for (var i = 0; i < arrLength; i++)
        {
            StrArr[i] = Pwd.substring(i, 6+i);
        }

        for (var i = 0; i < arrLength; i++)
        {
            if (UserID.indexOf(StrArr[i]) >= 0)
            { 
                 return true; 
            }
        }
    }
    return false;
}

//设置弱密码消息
var SetClientErrMsg = function (msg){
    	var lbl =  document.getElementById("lbl_Msg");
	    var errDemo = document.getElementById("errDemo");
	    if(errDemo != null)
	    errDemo.style.visibility= 'visible';
	    lbl.innerHTML = msg ; //
}  


//设置弱密码消息
var SetClientErrMsgForUpdate = function (msg){
    try{
	        var lbl =  document.getElementById("lbl_Msg");
	        lbl.innerHTML = msg ; //
    }
    catch(err){
        alert(err);
    }
}

	    
var BasicClientValidate = function(UserID,Pwd){

    if (UserID.length ==0 || UserID == '手机号/固话号/别名' || UserID == '手机号、固话号、别名' || UserID.indexOf("@") >=0){
        SetClientErrMsg("请输入手机号、固话号或别名");
        return false;
    }

    if (UserID.indexOf("$") >=0){
        SetClientErrMsg("用户名有禁用字符$。");
        return false;
    }


    if (Pwd.length ==0){
        SetClientErrMsg("请您输入密码。");
        return false;
    }

    if (Pwd.indexOf("$") >=0){
        SetClientErrMsg("密码有禁用字符$。");
        return false;
    }
    
    return true;
}
