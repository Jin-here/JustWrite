package Xuer.dz.net;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.net.ServerSocket;
import java.net.Socket;

public class ServerDZ extends Thread {
  private ServerDZ() throws IOException{ CreateSocket();}
  public void run(){
	  Socket client;
	  String txt;
	  try{
		  while(true){
	          client=ResponseSocket();
	          while(true){
		          txt=ReceiveMsg(client);
		          System.out.println(txt);
		          
		          SendMsg(client,txt);
		          if(true)break;
	              }
	          CloseSocket(client);
	          }
		  }
	  catch(IOException e)
	  { 
		  System.out.println(e);
	  }
	  
  }
  private ServerSocket server=null;
  private static final int PORT=12315;
  private BufferedWriter writer;
  private BufferedReader reader;
  //使用CreateSocket()方法来创建一个服务器
  private void CreateSocket() throws IOException{
	  server=new ServerSocket(PORT,100);
	  System.out.println("Server starting");
  }
  private Socket ResponseSocket() throws IOException{
	  Socket client=server.accept();//读取客户信息
	  System.out.println("client connected..");
	  return client;
  }
  //关闭服务器
  private void CloseSocket(Socket socket)throws IOException{
	  reader.close();
	  writer.close();
	  socket.close();
	  System.out.println("client closed..");
  }
  //广播信息
  private void SendMsg(Socket socket,String Msg)throws IOException{
	  writer=new BufferedWriter(new OutputStreamWriter(socket.getOutputStream()));//发送字符输出流
	  writer.write(Msg+"\n");
	  writer.flush();
  }
  private String ReceiveMsg(Socket socket)throws IOException{
	  reader=new BufferedReader(new InputStreamReader(socket.getInputStream()));// 读取字符输入流
	  System.out.println("server get input from client socket");
	  String txt="Server send:"+reader.readLine();
	  return txt;
  }
  //创建服务器
  public static void main(final String args[])throws IOException{
	  ServerDZ yaochatserver=new ServerDZ();
	  if(yaochatserver!=null){yaochatserver.start();}
  }
}
