package com.example.broadcast;



import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.telephony.SmsMessage;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.TextView;

import com.example.zidongfashoumima.R;


public class MyBroadcastReceiver extends BroadcastReceiver {

	@Override
	public void onReceive(Context context, Intent intent) {
		// TODO Auto-generated method stub
		SmsMessage[] messages = getMessagesFromIntent(intent);
		for (SmsMessage message : messages){
			String from = message.getOriginatingAddress();
			String content = message.getMessageBody();
			
			LayoutInflater inflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
			View layout = inflater.inflate(R.layout.main, null);
			TextView tv = (TextView)layout.findViewById(R.id.textView1);
			tv.setText(content);
		}
	}

	private SmsMessage[] getMessagesFromIntent(Intent intent){
		Object[] messages = (Object[])intent.getSerializableExtra("pdus");
		byte[][] pduObjs = new byte[messages.length][];
		for (int i = 0;i < messages.length;i++){
			pduObjs[i] = (byte[]) messages[i];
		}
		byte[][] pdus = new byte[pduObjs.length][];
		int pduCount = pdus.length;
		SmsMessage[] msgs = new SmsMessage[pduCount];
		for (int i = 0;i < pduCount;i++){
			pdus[i] = pduObjs[i];
			msgs[i] = SmsMessage.createFromPdu(pdus[i]);
		}
		return msgs;
	}
}
