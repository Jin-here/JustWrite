package com.example.util;

import android.app.Activity;
import android.content.Intent;
import android.net.Uri;
import oauth.signpost.OAuthProvider;
import oauth.signpost.basic.DefaultOAuthProvider;
import oauth.signpost.commonshttp.CommonsHttpOAuthConsumer;
import oauth.signpost.exception.OAuthCommunicationException;
import oauth.signpost.exception.OAuthExpectationFailedException;
import oauth.signpost.exception.OAuthMessageSignerException;
import oauth.signpost.exception.OAuthNotAuthorizedException;

public class OAuth {
	private CommonsHttpOAuthConsumer httpOauthConsumer;
	private OAuthProvider httpOauthprovider;
	private String APP_KEY;
	private String APP_SECRET;
	
	public static final String BOUNDARY = "";
	public static final String MP_BOUNDARY = "--" + BOUNDARY;
	public static final String END_MP_BOUNDARY = "--" + BOUNDARY + "--";
	public static final String MULTIPART_FROM_DATA = "multipart/form-data";
	
	private static OAuth instance = null;
	
	public static OAuth getInstance(){
		if (instance == null){
			instance = new OAuth();
		}
		return instance;
	}
	
	private OAuth(){
		//修改成自己的APP_KEY和APP_SECRET
		this("","");
	}
	
	private OAuth(String app_key,String app_secret){
		this.APP_KEY = app_key;
		this.APP_SECRET = app_secret;
	}
	
	public Boolean requestAccessToken(Activity activity,String callBackUrl){
		Boolean flag = false;
		
		try {
			httpOauthConsumer = new CommonsHttpOAuthConsumer(APP_KEY, APP_SECRET);
			httpOauthprovider = new DefaultOAuthProvider("http://api.t.sina.com.cn/oauth/request_token",
					"http://api.t.sina.com.cn/oauth/access_token",
					"http://api.t.sina.com.cn/oauth/authorize");
			String authUrl = httpOauthprovider.retrieveRequestToken(httpOauthConsumer, callBackUrl);
			activity.startActivity(new Intent(Intent.ACTION_VIEW,Uri.parse(authUrl)));
			flag = true;
		} catch (OAuthMessageSignerException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (OAuthNotAuthorizedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (OAuthExpectationFailedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (OAuthCommunicationException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return flag;
		
		
	}
}
